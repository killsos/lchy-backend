# App ROI Tracker - API æ¥å£æ–‡æ¡£

## æ¦‚è¿°
App ROI æ•°æ®è·Ÿè¸ªç³»ç»Ÿçš„åç«¯ API æ¥å£æ–‡æ¡£ï¼ŒåŸºäº Node.js + TypeScript + Express.js + MySQL + Sequelize æ„å»ºã€‚

## åŸºç¡€ä¿¡æ¯
- **Base URL**: `http://localhost:3200`
- **API å‰ç¼€**: `/api`
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

---

## æ•°æ®æ¨¡å‹

### AppRoiData è¡¨ç»“æ„
```typescript
interface AppRoiData {
  id: number;                    // ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
  date: string;                  // æ—¥æœŸ (YYYY-MM-DD)
  app_name: string;              // åº”ç”¨åç§° (æœ€å¤§50å­—ç¬¦)
  bid_type: string;              // å‡ºä»·ç±»å‹ (æœ€å¤§10å­—ç¬¦)
  country: string;               // å›½å®¶åœ°åŒº (æœ€å¤§50å­—ç¬¦)
  install_count: number;         // å®‰è£…æ¬¡æ•°
  roi_current?: number;          // å½“æ—¥ROI (ç²¾åº¦10,2)
  roi_1d?: number;              // 1æ—¥ROI (ç²¾åº¦10,2)
  roi_3d?: number;              // 3æ—¥ROI (ç²¾åº¦10,2)
  roi_7d?: number;              // 7æ—¥ROI (ç²¾åº¦10,2)
  roi_14d?: number;             // 14æ—¥ROI (ç²¾åº¦10,2)
  roi_30d?: number;             // 30æ—¥ROI (ç²¾åº¦10,2)
  roi_60d?: number;             // 60æ—¥ROI (ç²¾åº¦10,2)
  roi_90d?: number;             // 90æ—¥ROI (ç²¾åº¦10,2)
  createdAt: Date;              // åˆ›å»ºæ—¶é—´
  updatedAt: Date;              // æ›´æ–°æ—¶é—´
}
```

---

## API æ¥å£

### 1. å¥åº·æ£€æŸ¥

#### `GET /`
è·å–ç³»ç»ŸçŠ¶æ€

**å“åº”ç¤ºä¾‹:**
```json
{
  "message": "Hello world"
}
```

---

### 2. æ–‡ä»¶ä¸Šä¼ 

#### `GET /upload`
è·å– CSV æ–‡ä»¶ä¸Šä¼ é¡µé¢

**å“åº”**: HTML ä¸Šä¼ é¡µé¢

#### `POST /upload/csv`
ä¸Šä¼ å¹¶å¤„ç† CSV æ–‡ä»¶

**è¯·æ±‚å‚æ•°:**
- `file`: CSV æ–‡ä»¶ (multipart/form-data)

**æ–‡ä»¶é™åˆ¶:**
- æ ¼å¼: ä»…æ”¯æŒ .csv æ–‡ä»¶
- å¤§å°: æœ€å¤§ 5MB
- MIME ç±»å‹: text/csv

**CSV æ–‡ä»¶æ ¼å¼è¦æ±‚:**
```csv
date,app_name,bid_type,country,install_count,roi_1d,roi_3d,roi_7d,roi_14d,roi_30d,roi_60d,roi_90d,roi_current
2024-01-01,TestApp,CPC,US,100,1.5,2.0,2.5,3.0,3.5,4.0,4.5,1.2
```

**æˆåŠŸå“åº”:**
```json
{
  "success": true,
  "message": "CSVæ–‡ä»¶è§£æå¹¶æ’å…¥æ•°æ®åº“æˆåŠŸ",
  "details": {
    "csvRecords": 1000,
    "insertedRecords": 950,
    "totalRecords": 1000
  }
}
```

**é”™è¯¯å“åº”:**
```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°",
  "details": "è¯¦ç»†é”™è¯¯ä¿¡æ¯"
}
```

**å¯èƒ½çš„é”™è¯¯çŠ¶æ€ç :**
- `400`: æ–‡ä»¶æ ¼å¼é”™è¯¯ã€æœªä¸Šä¼ æ–‡ä»¶ã€æ–‡ä»¶è¿‡å¤§
- `500`: æ•°æ®åº“è¿æ¥å¤±è´¥ã€CSVè§£æå¤±è´¥ã€æ•°æ®æ’å…¥å¤±è´¥

---

### 3. ç­›é€‰å™¨æ•°æ®

#### `GET /api/filters`
è·å–æ‰€æœ‰å¯ç”¨çš„ç­›é€‰å™¨é€‰é¡¹

**åŠŸèƒ½æè¿°:**
- è·å–æ‰€æœ‰å”¯ä¸€çš„ app_name å€¼ï¼ˆæ— é‡å¤ï¼‰
- å½“ app_name æ•°æ®å­˜åœ¨æ—¶ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª app_name ä½œä¸ºæ¡ä»¶
- æŸ¥è¯¢è¯¥ app_name å¯¹åº”çš„æ‰€æœ‰å”¯ä¸€ country å€¼ï¼ˆæ— é‡å¤ï¼‰
- æŸ¥è¯¢è¯¥ app_name å¯¹åº”çš„æ‰€æœ‰å”¯ä¸€ bid_type å€¼ï¼ˆæ— é‡å¤ï¼‰
- ä½¿ç”¨ Sequelize å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "message": "è·å–ç­›é€‰å™¨æ•°æ®æˆåŠŸ",
  "data": {
    "app_names": [
      "App-1",
      "App-2", 
      "App-3"
    ],
    "countries": [
      "ç¾å›½",
      "è‹±å›½"
    ],
    "bid_types": [
      "CPI"
    ]
  }
}
```

**æ•°æ®ä¸ºç©ºæ—¶çš„å“åº”:**
```json
{
  "success": true,
  "message": "è·å–ç­›é€‰å™¨æ•°æ®æˆåŠŸ",
  "data": {
    "app_names": []
  }
}
```

**é”™è¯¯å“åº”:**
```json
{
  "success": false,
  "message": "è·å–ç­›é€‰å™¨æ•°æ®å¤±è´¥",
  "error": "æ•°æ®åº“è¿æ¥å¤±è´¥"
}
```

**æŠ€æœ¯å®ç°:**
- ä½¿ç”¨ Sequelize åŸç”Ÿ SQL æŸ¥è¯¢
- æ‰§è¡Œ `SELECT DISTINCT` å»é‡æŸ¥è¯¢
- `Promise.all()` å¹¶è¡Œæ‰§è¡Œæå‡æ€§èƒ½
- è‡ªåŠ¨è¿‡æ»¤ç©ºå€¼å’Œ NULL å€¼
- æŒ‰å­—æ¯é¡ºåºå‡åºæ’åˆ—

---

## é”™è¯¯å¤„ç†

### é€šç”¨é”™è¯¯æ ¼å¼
```json
{
  "success": false,
  "message": "é”™è¯¯æè¿°",
  "error": "å…·ä½“é”™è¯¯ä¿¡æ¯",
  "details": "è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"
}
```

### HTTP çŠ¶æ€ç 
- `200`: è¯·æ±‚æˆåŠŸ
- `400`: å®¢æˆ·ç«¯è¯·æ±‚é”™è¯¯
- `413`: æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
- `502`: ç½‘å…³é”™è¯¯
- `503`: æœåŠ¡ä¸å¯ç”¨
- `504`: è¯·æ±‚è¶…æ—¶

---

## å¼€å‘ä¿¡æ¯

### ç¯å¢ƒé…ç½®
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start
```

### æ•°æ®åº“è¿ç§»
```bash
# åˆ›å»ºæ•°æ®åº“
npm run db:create

# è¿è¡Œè¿ç§»
npm run migrate

# ç”Ÿæˆæ–°è¿ç§»
npm run generate:migration -- migration-name
```

### æ—¥å¿—ç³»ç»Ÿ
- ä½¿ç”¨ Winston æ—¥å¿—åº“
- å¼€å‘ç¯å¢ƒ: æ§åˆ¶å°è¾“å‡º
- ç”Ÿäº§ç¯å¢ƒ: æ–‡ä»¶æ—¥å¿—
- æ—¥å¿—çº§åˆ«: error, warn, info, debug

### ç¯å¢ƒå˜é‡
```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_password
DB_NAME=lchy

# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3200
LOG_LEVEL=debug

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_DIR=uploads
MAX_FILE_SIZE=5242880

# CORS é…ç½®
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
```

---

## æ›´æ–°æ—¥å¿—

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… åŸºç¡€é¡¹ç›®æ¶æ„
- âœ… CSV æ–‡ä»¶ä¸Šä¼ å’Œè§£æ
- âœ… æ•°æ®åº“å­˜å‚¨å’Œç®¡ç†
- âœ… ç­›é€‰å™¨æ•°æ®æ¥å£
- âœ… ä¸“ä¸šæ—¥å¿—ç³»ç»Ÿ
- âœ… å®Œå–„é”™è¯¯å¤„ç†
- âœ… TypeScript ç±»å‹å®‰å…¨
- âœ… ç¯å¢ƒå˜é‡é…ç½®
- âœ… äº‹åŠ¡æ”¯æŒ
- âœ… CORS å’Œå®‰å…¨ä¸­é—´ä»¶

### å¾…å®ç°åŠŸèƒ½
- ğŸ”„ æ•°æ®æŸ¥è¯¢å’Œåˆ†ææ¥å£
- ğŸ”„ æ•°æ®å¯¼å‡ºåŠŸèƒ½
- ğŸ”„ æ•°æ®å¯è§†åŒ–æ”¯æŒ
- ğŸ”„ API è®¤è¯å’Œæˆæƒ
- ğŸ”„ æ¥å£ç¼“å­˜æœºåˆ¶
- ğŸ”„ API é™æµä¿æŠ¤

---

*æ–‡æ¡£æœ€åæ›´æ–°: 2025-07-19*